@{
    Layout = "";
}
<script src="~/Resources/js/jquery-1.9.1.js"></script>
<script src="~/Resources/LoadjsPage/system.general.js"></script>
<link href="~/Resources/LoadjsPage/StyleSheet1.css" rel="stylesheet" />


@*<form id="upload" enctype="multipart/form-data" action="" method="POST">*@
<input type="file" multiple="multiple" style="width: 0.1px;height: 0.1px;opacity: 0;overflow: hidden;position: absolute;z-index: -1;" name="fileUpload" id="fileUpload" class="inputfile">
<label class="btn btn-success" for="fileUpload" style="width:100%;margin: 10px 0px;font-size:12px"><i class="fa fa-upload" aria-hidden="true"></i>upload</label>
@*</form>*@
@*<div id="ShowImg"></div>*@
<ul id="ShowImgM1"></ul>
<div style=" clear:both"></div>
<textarea type="text" name="txtMImage" id="txtMImage"></textarea>
@*<input type="text" name="txtMImage" id="txtMImage" />*@

<input type="hidden" name="txtShowEditImg" id="txtShowEditImg" value="@ViewBag.ShowEditImg" />

<style>
    /*Thêm nhiều ảnh*/
    #ShowImgM1 {
        margin: 0 0 7px 0px !important;
    }

    .boximg {
        width: 100%;
        height: 100%;
        border: 1px solid #ccc;
    }

    #ShowImgM1 li {
        display: block;
        position: relative;
        margin: 3px 3px 3px 0;
        padding: 5px;
        float: left;
        width: 90px;
        height: 90px;
    }

    .boximg img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .boximg:hover .btn-close {
        display: inline-block;
    }

    .boximg .btn-close {
        position: absolute;
        top: 0;
        right: 5px;
        font-size: 25px;
        line-height: 20px;
        display: none;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $("#fileUpload").change(function () {
            var vtrUpload = $("#fileUpload").val().toLowerCase();
            var regexVTRUpload = new RegExp("(.*?)\.(png|jpg|jpeg)$");
            if (!(regexVTRUpload.test(vtrUpload))) {
                $("#fileUpload").val("");
                alert("File không đúng định dạng. Vui lòng kiểm tra lại.");
            } else {
                UploadMultiple();
            }
        });
    });

    function UploadMultiple() {
        var data = new FormData(); //FormData object
        var fileInput = document.getElementById('fileUpload');
        for (i = 0; i < fileInput.files.length; i++) {
            data.append(fileInput.files[i].name, fileInput.files[i]);
        }
        data.append("foldername", 'Test');
        $.ajax({
            url: '@Url.Action("UploadFile_Multiple", "Ajax")',
            type: 'POST',
            data: data,
            //async: true,
            beforeSend: function () {
                // js_Loading(true, 0);
                js_Loading(true, 1);
            },
            success: function (data) {
                //if (data.code == 1) {
                //    // img_link = data.link;
                //    $('#imgLink').val();
                //    $('.img_src p').hide();
                //    $('#thum_img').css({ "width": "100%", "margin-top": "0px", "height": "70px", "object-fit": "contain" });
                //    $('#thum_img').attr("src", data.showfie);
                //    $('#real_img').attr("onclick", "fn_detail('" + data.link + "')");
                //    // $('#TaiFile').html("<a id=\"Link\" href=\"" + data.link + "\" style=\"color: #fff;width: 100%;margin: 17px 4px;font-size: 12px;background: #e6472e !important;padding: 6px 42px 6px 36px;\" target=\"_blank\">Tải File pdf</a>");
                //}

                //  $('#ShowImg').html(data.link);
                // alert(data.link);

                LoadImgGetSet(data.ImagesUrl, 'txtMImage');
                js_Loading(false, 0);
            },
            error: function () {
                js_Loading(false, 0);
                alert("Thiết bị không hỗ trợ up ảnh từ camera. Chọn file từ bộ nhớ thiết bị!");
            },
            cache: false,
            contentType: false,
            processData: false
        });
    }

    function LoadImgGetSet(strImg, inputimg) {
        var arr = strImg.split(',');
        var img = "";
        arr.forEach(function (item) {
            img += "<li class='ui-state-default'><div class='boximg'><a href='javascript:void(0)' onclick=\"deleteMuiti($(this),'" + inputimg + "');\" class='btn-close'>X</a> <img src='" + item + "' /> </div></li>";
        })
        $("#ShowImgM1").html($("#ShowImgM1").html() + img);
        $('#txtMImage').val(GetMuitiImg());
    }

    function GetMuitiImg() {
        var str = "";
        $(".boximg img").each(function () {
            str += $(this).attr('src') + ',';
        })
        return str;
    }

    function deleteMuiti(img, inputimg) {
        img.parent().parent().remove();
        $('#' + inputimg).val(GetMuitiImg());
    }

    //Edit
    $(function () {
        var txtShowEditImg = $('#txtShowEditImg').val();
        LoadImgGetSet(txtShowEditImg, 'txtMImage');
    });

</script>